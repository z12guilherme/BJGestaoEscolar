{% extends "base.html" %}

{% block content %}
<div class="container">
  <h2>Editar usuário: {{ user.username }}</h2>

  <form method="POST">
    <div class="form-group">
      <label for="role">Categoria</label>
      <select class="form-control" id="role" name="role" required>
        <option value="">Selecione...</option>
        <option value="SecretarioEducacao" {% if user.role == 'SecretarioEducacao' %}selected{% endif %}>Secretário de Educação</option>
        <option value="Diretor" {% if user.role == 'Diretor' %}selected{% endif %}>Diretor</option>
        <option value="Professor" {% if user.role == 'Professor' %}selected{% endif %}>Professor</option>
      </select>
    </div>

    <div class="form-group">
      <label for="school_id">Escola</label>
      <select class="form-control" id="school_id" name="school_id">
        <option value="">Selecione...</option>
        {% for school in schools %}
        <option value="{{ school.id }}" {% if user.school_id == school.id %}selected{% endif %}>{{ school.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group" id="teacher_fields" style="display: {% if user.role == 'Professor' %}block{% else %}none{% endif %}">
      <label for="name">Nome do Professor</label>
      <input class="form-control" type="text" name="name" value="{% if user.teacher %}{{ user.teacher.name }}{% endif %}">
      <label for="subject" class="mt-2">Matéria</label>
      <input class="form-control" type="text" name="subject" value="{% if user.teacher %}{{ user.teacher.subject }}{% endif %}">
    </div>

    <button type="submit" class="btn btn-primary mt-2">Salvar Alterações</button>
    <a href="{{ url_for('manage_users') }}" class="btn btn-secondary mt-2">Voltar</a>
  </form>
</div>

<script>
document.getElementById('role').addEventListener('change', function() {
    var role = this.value;
    var teacherFields = document.getElementById('teacher_fields');
    var schoolSelect = document.getElementById('school_id');
    if (role === 'Professor' || role === 'Diretor') {
        schoolSelect.required = true;
        if (role === 'Professor') {
            teacherFields.style.display = 'block';
            document.querySelector('input[name="name"]').required = true;
            document.querySelector('input[name="subject"]').required = true;
        } else {
            teacherFields.style.display = 'none';
            document.querySelector('input[name="name"]').required = false;
            document.querySelector('input[name="subject"]').required = false;
        }
    } else {
        schoolSelect.required = false;
        teacherFields.style.display = 'none';
        document.querySelector('input[name="name"]').required = false;
        document.querySelector('input[name="subject"]').required = false;
    }
});
</script>
{% endblock %}
